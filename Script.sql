create table model(

model_name varchar(100) not null primary key,
engine_power int4 not null,
category varchar (100) not null,
permitted_weight int4 not null,
unladen_mass int4 not null,
year_release int4 not null
);


insert into model values
('ЛИАЗ-5292', 203, 'Низкопольный', 18000, 10500, 2019),
('ЛИАЗ-5256', 180, 'Низкопольный', 17930, 10368, 1986),
('ЛИАЗ-6213', 206, 'Низкопольный', 26700, 15730, 2004),
('МАЗ-203', 170, 'Низкопольный', 18000, 10860, 2006),
('МАЗ-206', 177, 'Низкопольный', 20000, 12910, 2006),
('ЛИАЗ-4292', 210, 'Низкопольный', 14400, 9020, 2015),
('ЛИАЗ-6274', 217, 'Низкопольный', 18000, 12200, 2018),
('НЕФАЗ-5299', 260, 'Низкопольный', 18000, 10450, 2000),
('КАМАЗ-6282', 163, 'Низкопольный', 18000, 12200, 2018);



select * from model

//////////////////////////////////////////////////////////////////////////////

create table transport_company(

company_name varchar(100) not null primary key,
contact_info varchar(100) not null,
address varchar(100) not null
);


insert into transport_company values
('Пассажиравтотранс','zakaz@avtobus.spb','195197, Санкт-Петербург, Полюстровский пр., д.39'),
('СТОЛИЧНАЯ','info@moscowbus.ru','109004, Москва, Николоямский переулок, 4-6, строение 3'),
('AMG travel','info@amgtravel.ru','196084, Санкт-Петербург, Лиговский проспект, 10/118'),
('AVRORATUR','avroratur31@mail.ru','308002, г. Белгород, пр-т Б. Хмельницкого, д. 64, оф. 16'),
('Mtravel','mtravel@yandex.ru','107045, г. Москва, Большой Головин переулок, дом 12, корпус 2, офис 214');



select * from transport_company

//////////////////////////////////////////////////////////////////////////////


create table route(

route_number int4 not null primary key,
company_name varchar(100) references transport_company(company_name),
route_length int4 not null,
route_time time not null
);


insert into route values
(852, 'Пассажиравтотранс', 15, '01:34:06'),
(814, 'AVRORATUR', 30, '03:10:20'),
(173, 'СТОЛИЧНАЯ', 20, '02:15:00'),
(013, 'Mtravel', 25, '02:00:15'),
(921, 'AMG travel', 10, '00:45:30'),
(159, 'Пассажиравтотранс', 10, '01:04:19'),
(291, 'СТОЛИЧНАЯ', 26, '02:49:27'),
(114, 'AVRORATUR', 5, '00:27:42'),
(461, 'AMG travel', 20, '02:05:10'),
(706, 'Mtravel', 20, '01:40:41');



select * from route

//////////////////////////////////////////////////////////////////////////////

create table vehicle(

reg_number int4 not null primary key,
model_name varchar(100) references model(model_name),
route_number int4 references route(route_number),
vh_condition varchar (100) not null,
capacity int4 not null
);


insert into vehicle values
(178012, 'ЛИАЗ-5292', 852, 'Хорошее', 100),
(242845, 'ЛИАЗ-5256', 173, 'Отличное', 90),
(328643, 'МАЗ-203', 159, 'Пригодное', 120),
(443574, 'ЛИАЗ-6213', 921, 'Плохое', 130),
(565326, 'МАЗ-206', 291, 'Отличное', 120),
(386476, 'КАМАЗ-6282', 814, 'Хорошее', 100),
(364736, 'НЕФАЗ-5299', 461, 'Пригодное', 130),
(587485, 'ЛИАЗ-6274', 013, 'Пригодное', 140),
(984374, 'МАЗ-206', 114, 'Пригодное', 120),
(908787, 'ЛИАЗ-5292', 852, 'Пригодное', 100),
(139048, 'МАЗ-203', 291, 'Пригодное', 120),
(974367, 'ЛИАЗ-4292', 706, 'Хорошее', 140);

select * from vehicle

//////////////////////////////////////////////////////////////////////////////

create table driver(

driver_shift_id int4 not null primary key,
license varchar(100) not null,
route_number int4 references route(route_number),
driver_name varchar(100) not null,
driver_surname varchar(100) not null,
driver_third_name varchar(100) not null,
experience int4 not null,
gender varchar(1) not null,
driver_age varchar(3) not null,
telephone_number varchar(100) not null
);

insert into driver values
(632,'7bf3e4re374', 852, 'Иван', 'Петров', 'Алексеевич', 5, 'М', '35', '+7 (123) 456-7890'),
(973,'n03xt4b46c4', 921, 'Елена', 'Смирнова', 'Сергеевна', 8, 'Ж', '42', '+7 (987) 654-3210'),
(345,'4b4cny7n44c', 159, 'Алексей', 'Иванов', 'Андреевич', 3, 'М', '28', '+7 (321) 987-6540'),
(038,'cn4y754bcn4', 173, 'Мария', 'Сидорова', 'Александровна', 2, 'Ж', '30', '+7 (111) 222-3333'),
(253,'n38b3cn7478', 291, 'Александр', 'Козлов', 'Игоревич', 7, 'М', '45', '+7 (444) 555-6666'),
(682,'7bf3e4re374', 013, 'Иван', 'Петров', 'Алексеевич', 5, 'М', '35', '+7 (123) 456-7890'),
(872,'cn4y754bcn4', 852, 'Мария', 'Сидорова', 'Александровна', 2, 'Ж', '30', '+7 (111) 222-3333'),
(900,'n498c7548n5', 461, 'Екатерина', 'Морозова', 'Дмитриевна', 4, 'Ж', '26', '+7 (777) 888-9999'),
(463,'cn744nc45t6', 114, 'Денис', 'Волков', 'Олегович', 6, 'М', '38', '+7 (999) 000-1111'),
(542,'cn4y754bcn4', 814, 'Мария', 'Сидорова', 'Александровна', 2, 'Ж', '30', '+7 (111) 222-3333'),
(387,'387498nc547', 706, 'Анна', 'Иванова', 'Петровна', 3, 'Ж', '29', '+7 (222) 333-4444'),
(374,'3477c5475tn', 173, 'Дмитрий', 'Смирнов', 'Александрович', 9, 'М', '50', '+7 (555) 666-7777'),
(346,'v587457v785', 852, 'Ольга', 'Ковалева', 'Викторовна', 5, 'Ж', '32', '+7 (888) 999-0000');



select * from driver

//////////////////////////////////////////////////////////////////////////////

create table point(

point_id int4 not null primary key,
route_number int4 references route(route_number),
stop_number int4 references stop(stop_number),
index_number int4 not null
);

insert into point values
(329087,291,543,4),
(738477,852,782,1),
(908237,291,504,1),
(483297,461,823,8),
(823079,291,112,5),
(930943,814,388,3),
(843973,173,247,2),
(209487,114,384,6),
(829738,921,168,6),
(930889,461,623,3),
(283728,921,568,3),
(478938,159,126,4),
(874837,013,999,5),
(493827,706,792,5),
(593985,013,600,4),
(908382,013,584,6),
(930897,114,237,5),
(734834,814,143,7),
(183298,013,889,2),
(823972,852,193,2),
(123248,114,001,2),
(842744,921,295,2),
(291090,173,001,5),
(283274,814,032,8),
(143473,814,313,4),
(382974,173,782,3),
(349089,706,419,3),
(920378,114,154,1),
(384397,173,889,1),
(204884,852,183,6),
(920382,921,313,7),
(208749,461,729,9),
(742874,921,734,1),
(474937,814,748,9),
(328938,159,679,1),
(194384,013,032,1),
(228947,852,001,3),
(380794,114,782,4),
(823072,461,789,1),
(397847,173,093,4),
(849289,159,043,2),
(489378,706,234,2),
(290384,461,168,2),
(203948,814,293,6),
(287494,114,194,3),
(389473,814,600,5),
(392084,291,878,3),
(294827,921,445,5),
(292872,921,584,8),
(489284,013,313,3),
(289472,921,199,4),
(439045,852,909,7),
(173874,706,728,1),
(438294,461,975,6),
(938473,814,001,1),
(828408,814,790,2),
(902483,461,946,4),
(390287,159,623,5),
(209328,461,473,5),
(940287,461,573,10),
(920387,291,436,2),
(492742,461,419,7),
(456789,852,914,4),
(489738,706,853,4),
(842998,159,001,3),
(842984,852,093,5);



select * from point

/////////////////////////
(738477,852,782,1),
(823972,852,193,2),
(228947,852,001,3),
(456789,852,914,4),
(842984,852,093,5),
(204884,852,183,6),
(439045,852,909,7),
(938473,814,001,1),
(828408,814,790,2),
(930943,814,388,3),
(143473,814,313,4),
(389473,814,600,5),
(203948,814,293,6),
(734834,814,143,7),
(283274,814,032,8),
(474937,814,748,9),
(384397,173,889,1),
(843973,173,247,2),
(382974,173,782,3),
(397847,173,093,4),
(291090,173,001,5),
(194384,013,032,1),
(183298,013,889,2),
(489284,013,313,3),
(593985,013,600,4),
(874837,013,999,5),
(908382,013,584,6),
(742874,921,734,1),
(842744,921,295,2),
(283728,921,568,3),
(289472,921,199,4),
(294827,921,445,5),
(829738,921,168,6),
(920382,921,313,7),
(292872,921,584,8),
(328938,159,679,1),
(849289,159,043,2),
(842998,159,001,3),
(478938,159,126,4),
(390287,159,623,5),
(908237,291,504,1),
(920387,291,436,2),
(392084,291,878,3),
(329087,291,543,4),
(823079,291,112,5),
(920378,114,154,1),
(123248,114,001,2),
(287494,114,194,3),
(380794,114,782,4),
(930897,114,237,5),
(209487,114,384,6),
(823072,461,789,1),
(290384,461,168,2),
(930889,461,623,3),
(902483,461,946,4),
(209328,461,473,5),
(438294,461,975,6),
(492742,461,419,7),
(483297,461,823,8),
(208749,461,729,9),
(940287,461,573,10),
(173874,706,728,1),
(489378,706,234,2),
(349089,706,419,3),
(489738,706,853,4),
(493827,706,792,5),
////////////////////////




//////////////////////////////////////////////////////////////////////////////

create table stop(

stop_number int4 not null primary key,
stop_name varchar(100) not null,
coordinates varchar(100) not null
);

insert into stop values
(782, 'Остановка Парковая', '60.12345, 30.67890'),
(543, 'Станция Морская', '62.34567, 35.43210'),
(237, 'Платформа Солнечная', '70.98765, 40.12345'),
(183, 'Остановка Лесная', '55.55555, 37.77777'),
(914, 'Станция Речная', '45.67890, 55.43210'),
(193, 'Платформа Зеленая', '50.12345, 30.98765'),
(112, 'Остановка Горная', '48.76543, 36.54321'),
(154, 'Станция Железная', '63.21098, 34.56789'),
(194, 'Платформа Цветочная', '52.34567, 38.76543'),
(093, 'Остановка Полярная', '70.12345, 31.98765'),
(001, 'Станция Зимняя', '48.98765, 32.10987'),
(909, 'Платформа Летняя', '58.76543, 29.87654'),
(823, 'Остановка Весенняя', '64.32109, 39.87654'),
(728, 'Станция Осенняя', '49.87654, 42.10987'),
(234, 'Платформа Морозная', '67.54321, 28.98765'),
(729, 'Остановка Солнечная', '52.10987, 41.23456'),
(143, 'Станция Лунная', '55.43210, 37.55555'),
(043, 'Платформа Ветровая', '66.54321, 38.76543'),
(032, 'Остановка Звездная', '59.87654, 35.43210'),
(748, 'Станция Радужная', '51.23456, 42.10987'),
(573, 'Платформа Лесная', '68.76543, 36.54321'),
(853, 'Остановка Морская', '61.09876, 39.87654'),
(293, 'Станция Парковая', '54.32109, 31.23456'),
(975, 'Платформа Горная', '69.87654, 30.54321'),
(384, 'Остановка Железная', '56.54321, 34.98765'),
(419, 'Станция Цветочная', '47.65432, 41.09876'),
(790, 'Платформа Полярная', '71.09876, 28.54321'),
(473, 'Остановка Зимняя', '57.43210, 36.98765'),
(792, 'Станция Летняя', '65.43210, 33.21098'),
(946, 'Звездный переулок', '62.10987, 32.98765'),
(388, 'Солнечная аллея', '65.43210, 35.54321'),
(623, 'Полярный проезд', '73.21098, 40.65432'),
(600, 'Лунная улица', '58.65432, 39.10987'),
(313, 'Цветочный проезд', '47.78901, 53.32109'),
(168, 'Речная набережная', '50.87654, 32.23456'),
(789, 'Морская улица', '48.65432, 36.43210'),
(445, 'Парковый проезд', '65.98765, 34.21098'),
(878, 'Горная улица', '54.21098, 38.65432'),
(568, 'Зимний переулок', '73.34567, 30.87654'),
(199, 'Весенний проезд', '51.10987, 29.98765'),
(584, 'Летняя аллея', '61.87654, 27.54321'),
(999, 'Железная улица', '67.43210, 37.10987'),
(679, 'Осенняя улица', '52.54321, 39.65432'),
(126, 'Морозный переулок', '70.32109, 26.78901'),
(889, 'Лесная аллея', '54.43210, 41.87654'),
(436, 'Ветровая улица', '57.78901, 37.54321'),
(247, 'Радужный проезд', '68.87654, 38.21098'),
(504, 'Солнечный переулок', '61.54321, 33.65432'),
(295, 'Железнодорожная улица', '53.34567, 40.98765'),
(734,'Севанская улица','55.623732, 37.657601');

select * from stop

//////////////////////////////////////////////////////////////////////////////

insert into model values
('МАЗ-592',219,'Низкопольный',20000,13450,2013);

select * from model

delete from model
where year_release = 2013;

select * from model

update model
set engine_power = 199
where year_release = 2013;

select * from model

//////////////////////////////////////////////////////////////////////////////

select p.point_id, r.route_number
from point p
join route r on p.route_number = r.route_number
where r.route_number = 852;

//////////////////////////////////////////////////////////////////////////////

select d.driver_name, d.driver_surname, v.model_name
from driver d 
join route r on r.route_number = d.route_number
join vehicle v on v.route_number = r.route_number
where r.route_number = 173;

//////////////////////////////////////////////////////////////////////////////

select r.route_number, tc.contact_info, tc.company_name 
from route r
join transport_company tc on tc.company_name = r.company_name
where r.company_name  = 'Пассажиравтотранс';

select * from route

//////////////////////////////////////////////////////////////////////////////

select m.model_name, m.category, m.engine_power 
from model m
where m.engine_power > 180;


//////////////////////////////////////////////////////////////////////////////

select r.route_number, v.model_name 
from transport_company tc 
join route r on r.company_name = tc.company_name
join vehicle v on r.route_number = v.route_number
where tc.company_name = 'AVRORATUR';

//////////////////////////////////////////////////////////////////////////////

Запрос на поиск водителя с наименьшим стажем и маршрута, к которому
он(а) прикреплён(ена):

select d.driver_name, d.driver_surname, d.driver_third_name, d.gender, d.driver_age, d.experience ,string_agg(cast(d.route_number as text), ', ') as routes
from driver d
join route r on d.route_number = r.route_number
where d.experience = (select min(experience) from driver)
group by d.driver_name, d.driver_surname, d.driver_third_name, d.gender, d.driver_age, d.experience;

//////////////////////////////////////////////////////////////////////////////

Запрос на поиск моделей автобусов и маршрутов по которым они ходят. Подсчитать повторяющиеся модели

select m.model_name, string_agg(cast(v.route_number as text), ', ') as routes, count(*) as models
from model m 
join vehicle v on v.model_name = m.model_name
join route r on r.route_number = v.route_number
group by m.model_name;
/////////
select  m.model_name, string_agg(cast(v.route_number as text), ', ') AS routes, count(*) AS models
from model m 
join vehicle v on v.model_name = m.model_name
where v.route_number in (
  select route_number
  from route
)
group by m.model_name;


//////////////////////////////////////////////////////////////////////////////

Запрос на поиск индивидуального номера точки, номера остановки, наименования остановки и номера индекса по маршруту 461.
Отсортировать номер индекса по возрастанию

select p.route_number, p.point_id, p.stop_number, s.stop_name, p.index_number 
from point p 
join stop s on s.stop_number = p.stop_number
where p.route_number = 461
order by p.index_number asc;
////////
select p.route_number, p.point_id, p.stop_number, s.stop_name, p.index_number 
from point p 
join stop s on s.stop_number = p.stop_number
where exists (
  select  1
  from point p2
  where p2.route_number = 461
    and p2.point_id = p.point_id
)
order by p.index_number asc;



//////////////////////////////////////////////////////////////////////////////

